<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Servicio - Quetzal Platform</title>
    <link rel="stylesheet" href="../public/css/main.css">
    <link rel="stylesheet" href="../public/css/components.css">
    <link rel="stylesheet" href="../public/css/visitor.css">
</head>
<body>
    <!-- Navegaci√≥n -->
    <nav class="navbar">
        <div class="container navbar-content">
            <a href="landing-page.html" class="navbar-brand">
                <span class="navbar-brand-icon">ü¶ú</span>
                Quetzal Platform
            </a>
            <ul class="navbar-menu">
                <li><a href="landing-page.html" class="navbar-link">Inicio</a></li>
                <li><a href="services-public.html" class="navbar-link">Servicios</a></li>
                <li><a href="login.html" class="btn btn-primary">Iniciar Sesi√≥n</a></li>
                <li><a href="register.html" class="btn btn-secondary">Registrarse</a></li>
            </ul>
        </div>
    </nav>

    <div class="service-detail">
        <!-- Contenido Principal -->
        <div class="service-main">
            <div id="serviceContent">
                <div class="loading">Cargando detalles del servicio...</div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="service-sidebar">
            <div id="serviceSidebar">
                <!-- Se cargar√° din√°micamente -->
            </div>
        </div>
    </div>

    <script src="../public/js/config.js"></script>
    <script src="../public/js/app.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const serviceId = urlParams.get('id');

        async function loadServiceDetail() {
            if (!serviceId) {
                window.location.href = 'services-public.html';
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/services/${serviceId}`);
                const data = await response.json();

                if (data.success) {
                    renderService(data.data);
                } else {
                    renderError();
                }
            } catch (error) {
                console.error('Error:', error);
                renderError();
            }
        }

        function renderService(service) {
            const categoryIcons = {
                'dise√±o': 'üé®',
                'programaci√≥n': 'üíª',
                'marketing': 'üì±',
                'escritura': '‚úçÔ∏è',
                'traducci√≥n': 'üåê',
                'educaci√≥n': 'üìö',
                'hogar': 'üè†',
                'otro': '‚ö°'
            };

            // Contenido principal
            document.getElementById('serviceContent').innerHTML = `
                <div class="service-image-detail">${categoryIcons[service.category?.toLowerCase()] || '‚ö°'}</div>
                
                <span class="service-category">${service.category || 'General'}</span>
                <h1>${service.title}</h1>
                
                <div class="rating-display">
                    <span>‚≠ê</span>
                    <span>${service.averageRating || '5.0'}</span>
                    <span style="color: #666;">(${service.totalReviews || 0} rese√±as)</span>
                </div>

                <div class="provider-info">
                    <div class="provider-avatar">${(service.User?.fullName || 'P')[0].toUpperCase()}</div>
                    <div>
                        <div class="font-bold">${service.User?.fullName || 'Proveedor'}</div>
                        <div class="text-secondary text-sm">
                            ${service.User?.city ? `üìç ${service.User.city}` : ''}
                        </div>
                    </div>
                </div>

                <h2>Descripci√≥n del Servicio</h2>
                <p class="line-height-relaxed">${service.description || 'Sin descripci√≥n disponible'}</p>

                <h2>Detalles</h2>
                <ul class="line-height-relaxed">
                    <li><strong>Categor√≠a:</strong> ${service.category || 'General'}</li>
                    <li><strong>Tiempo de entrega:</strong> ${service.deliveryTime || 'A convenir'} d√≠as</li>
                    <li><strong>Disponibilidad:</strong> ${service.isActive ? '‚úÖ Disponible' : '‚ùå No disponible'}</li>
                </ul>

                ${service.Ratings && service.Ratings.length > 0 ? `
                    <div class="reviews-section">
                        <h2>Rese√±as (${service.Ratings.length})</h2>
                        ${service.Ratings.map(rating => `
                            <div class="review-card">
                                <div class="flex-between mb-2">
                                    <strong>${rating.User?.fullName || 'Usuario'}</strong>
                                    <span>‚≠ê ${rating.rating}/5</span>
                                </div>
                                <p>${rating.comment || ''}</p>
                                <small class="text-muted">${new Date(rating.createdAt).toLocaleDateString()}</small>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;

            // Sidebar
            document.getElementById('serviceSidebar').innerHTML = `
                <div class="price-box">
                    <div class="text-muted mb-2">Precio</div>
                    <div class="price">Q${service.price}</div>
                </div>

                <div class="cta-box">
                    <h3 class="mt-0">¬øInteresado en este servicio?</h3>
                    <p>Reg√≠strate para contactar al proveedor y realizar la contrataci√≥n</p>
                    <a href="register.html" class="btn btn-primary btn-block mt-3">
                        Registrarse Gratis
                    </a>
                    <a href="login.html" class="btn btn-secondary btn-block mt-2">
                        Ya tengo cuenta
                    </a>
                </div>

                <div class="mt-4 p-3 bg-tertiary rounded-lg">
                    <h4>‚ú® Con una cuenta podr√°s:</h4>
                    <ul class="line-height-relaxed">
                        <li>Contactar proveedores</li>
                        <li>Contratar servicios</li>
                        <li>Ofrecer tus servicios</li>
                        <li>Sistema de pagos seguro</li>
                        <li>Calificar y comentar</li>
                    </ul>
                </div>
            `;
        }

        function renderError() {
            document.getElementById('serviceContent').innerHTML = `
                <div class="text-center p-6">
                    <h2>‚ö†Ô∏è No se pudo cargar el servicio</h2>
                    <p>El servicio no existe o no est√° disponible</p>
                    <a href="services-public.html" class="btn btn-primary mt-3">Ver todos los servicios</a>
                </div>
            `;
            document.getElementById('serviceSidebar').innerHTML = '';
        }

        loadServiceDetail();
    </script>
</body>
</html>
